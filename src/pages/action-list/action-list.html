<ion-header>
  <ion-navbar *ngIf="!enableSearch">
    <ion-title>
      {{mainService.title}}
    </ion-title>
    <ion-buttons end>
      <button (click)="toggleSearch()" ion-button icon-only>
        <ion-icon name="search"></ion-icon>
      </button>
    </ion-buttons>
  </ion-navbar>
  <ion-navbar *ngIf="enableSearch">
    <div>
      <input class="input-save" placeholder="Search" type="search" name="search" (input)="getItems($event)" />
    </div>
    <ion-buttons end>
      <button (click)="toggleSearch()" ion-button clear color="primary">
        Cancel
      </button>
    </ion-buttons>
  </ion-navbar>
  <ion-toolbar class="custom-ion-toolbar" no-border-top>
    <ion-segment *ngIf="mainService.actionFilter.projectID == null" [(ngModel)]="this.mainService.selected">
      <ion-segment-button (click)="filter('active')" value="active">
        Active
      </ion-segment-button>
      <ion-segment-button (click)="filter('ended')" value="ended">
        Done
      </ion-segment-button>
    </ion-segment>
    <ion-segment *ngIf="mainService.actionFilter.projectID != null" [(ngModel)]="this.mainService.selected">
      <ion-segment-button (click)="filter('active')" value="active">
        Active
      </ion-segment-button>
      <ion-segment-button (click)="filter('ended')" value="ended">
        Done
      </ion-segment-button>
      <ion-segment-button (click)="docs()" value="documents">
        Docs
      </ion-segment-button>
    </ion-segment>
  </ion-toolbar>
</ion-header>
<ion-content>
  <ion-refresher (ionRefresh)="doRefresh($event)">
    <ion-refresher-content></ion-refresher-content>
  </ion-refresher>
  <div *ngIf="mainService.viewDocument">
    <ion-card *ngFor="let file of mainService.files">
      <img *ngIf="file.type == 0" [src]="file.img" (click)="openPicture(file)" />
      <div *ngIf="file.type == 1" class="custom-file-document" (click)="openFile(file)">
        <img style="margin:auto 0;" src="assets/images/default.png">
      </div>
      <ion-card-content>
        <p>
          {{file.name}}
        </p>
      </ion-card-content>
    </ion-card>
  </div>
  <ion-list no-lines *ngIf="!mainService.viewDocument">
    <ion-item-sliding #item *ngFor="let action of mainService.actions" [ngClass]="{'remove-item': action.remove}">
      <div class="primary-button" ion-item detail-none (click)="detail(action)">
        <div class="color-bar tag{{action.color}}"></div>
        <div class="list-button">          
          <h2><span class="custom-new-updates" *ngIf="action.countUpdates > 0"></span> {{action.shortSubject}}</h2> 
        <p>
          <span class="users" *ngFor="let user of action.assignedUsers"><ion-icon name="icon-user"></ion-icon> {{ user.names }}</span>
          <span class="users" *ngFor="let project of action.projects">{{ project.name }}</span>
        </p>
        </div> 
        <ion-note class="custom-ion-note" *ngIf="action.status == 0" item-end [innerHtml]="action.dueDate | dateColor"></ion-note>              
        <ion-note class="custom-ion-note" *ngIf="action.status == 1" item-end [innerHtml]="action.finalizedDate | dateColor:action.dueDate"></ion-note>
      </div>
      <ion-item-options *ngIf="action.status == 0" side="right" (ionSwipe)="done(action)">
        <button class="button-swipe button-more" ion-button (click)="openmenu(action, item)" color="light">
          <ion-icon class="custom-icon" name="more"></ion-icon>
          <span>More</span>
        </button>
        <button class="button-swipe" ion-button expandable color="secondary" (click)="done(action)">
          <ion-icon class="custom-icon" name="checkmark"></ion-icon>
          <span>Done</span>
        </button>
      </ion-item-options>
      <ion-item-options *ngIf="action.status == 1" side="right" (ionSwipe)="done(action)">
        <button class="button-swipe" ion-button (click)="remove(action)" color="danger">
          <ion-icon class="custom-icon" name="trash"></ion-icon>
          <span>Delete</span>
        </button>
        <button class="button-swipe button-more" ion-button expandable color="light" (click)="done(action)">
          <ion-icon class="custom-icon" name="checkmark"></ion-icon>
          <span>Reactive</span>
        </button>
      </ion-item-options>
    </ion-item-sliding>
  </ion-list>
  <ion-infinite-scroll (ionInfinite)="doInfinite($event)">
    <ion-infinite-scroll-content></ion-infinite-scroll-content>
  </ion-infinite-scroll>
</ion-content>
<ion-footer>
  <ion-toolbar>
    <button ion-button menuToggle color="primary">
      <ion-icon name="menu"></ion-icon>
    </button>
    <ion-buttons end>
      <button (click)="newAction()" ion-button icon-right color="primary">
        New action
      </button>
    </ion-buttons>
  </ion-toolbar>
</ion-footer>